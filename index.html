<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ROASTED FLAVORS DASHBOARD</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@500&display=swap');
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Roboto', sans-serif;
    }
    body {
      background: url('BG Dashboard Sora Night.png') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      overflow-x: hidden;
    }
    .dashboard {
      position: absolute;
      top: 20px;
      right: 20px;
      max-width: 260px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .card {
      background-color: rgba(0, 0, 0, 0.5);
      border-radius: 10px;
      padding: 10px 16px;
      font-size: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #ccc;
      position: relative;
    }
.toggle-buttons {
  background-color: rgba(0, 0, 0, 0.5);
  border-radius: 10px;
  padding: 10px 16px;
  font-size: 14px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: #ccc;
  position: relative;
  margin-top: 10px;
}
.toggle-buttons button {
  background: rgba(255, 255, 255, 0.05);
  border: none;
  color: #eee;
  border-radius: 6px;
  padding: 4px 10px;
  cursor: pointer;
  font-size: 18px;
  transition: background 0.2s;
}
.toggle-buttons button:hover {
  background: rgba(255, 255, 255, 0.2);
}

    .value { font-weight: bold; }
    .header { font-weight: bold; font-size: 13px; margin-bottom: 4px; color: #aaa; }
    .meta { font-size: 12px; color: #999; margin-bottom: 6px; }
    .title { font-size: 14px; font-weight: bold; margin-bottom: 4px; }
    .status-box { text-align: right; }
    .highlight-green { color: #00e676; }
    .highlight-orange { color: #ffb300; }
    .highlight-red { color: #ff5252; }
    .log, .graph { display: none; position: absolute; left: 20px; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 8px; color: #ccc; font-size: 12px; }
    .log {
  display: none;
  position: absolute;
  left: 20px;
  bottom: 20px;
  background: rgba(0, 0, 0, 0.5);
  padding: 10px;
  border-radius: 8px;
  color: #ccc;
  font-size: 12px;
  width: calc(100% - 40px); /* ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö graph */
  max-height: 150px;
  overflow-y: auto;
}
    .graph {
  bottom: 180px;
  left: 20px;
  width: calc(100% - 40px); /* ‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö log */
  background: rgba(0, 0, 0, 0.5);
  padding: 10px;
  border-radius: 8px;
  color: #ccc;
  font-size: 12px;
  height: 200px;
}
    @media (max-width: 768px) {
      .dashboard { top: 10px; right: 10px; max-width: 95vw; }
      .card { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <div class="status-box">
      <div class="title">ROASTED FLAVORS DASHBOARD</div>
      <div class="meta">Updated: <span id="updated"></span></div>
      <div class="meta">Weather: <span id="weather"></span></div>
    </div>
    <div class="card"><div class="header">Temperature</div><div class="value highlight-green" id="temp">0.00 ¬∞C</div></div>
    <div class="card"><div class="header">CO‚ÇÇ</div><div class="value highlight-orange" id="co2">0.00 ppm</div></div>
    <div class="card"><div class="header">NH‚ÇÉ</div><div class="value highlight-orange" id="nh3">0.00 ppm</div></div>
    <div class="card"><div class="header">Benzene</div><div class="value highlight-green" id="benzene">0.00 ppm</div></div>
    <div class="card"><div class="header">Alcohol</div><div class="value highlight-red" id="alcohol">0.00 ppm</div></div>
    <div class="card"><div class="header">Smoke</div><div class="value highlight-green" id="smoke">0.00 ppm</div></div>
    <div class="card"><div class="header">PM1.0</div><div class="value highlight-green" id="pm1">0 ¬µg/m¬≥</div></div>
    <div class="card">
      <div class="header">PM2.5</div>
      <div class="value highlight-green" id="pm25">0 ¬µg/m¬≥</div>
      <div class="toggle-buttons">
        <button onclick="toggleLog()">Log</button>
        <button onclick="toggleGraph()">Graph</button>
      </div>
    </div>
  </div>

  <div class="graph" id="graphBox"><canvas id="chart"></canvas></div>
  <div class="log" id="logBox">Full Log (Recent)</div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    function updateTime() {
      const now = new Date();
      document.getElementById('updated').innerText = now.toLocaleString();
      const hour = now.getHours();
      const isNight = hour < 6 || hour >= 18;
      document.body.style.backgroundImage = isNight
        ? "url('BG Dashboard Sora Night.png')"
        : "url('BG Dashboard Sora Day.png')";
      document.getElementById('weather').innerText = isNight ? 'üåô' : '‚òÄÔ∏è';
    }
    let chart;
    function drawChart(data) {
      const ctx = document.getElementById('chart').getContext('2d');
      chart?.destroy();
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.map(e => new Date(e.created_at).toLocaleTimeString()),
          datasets: [{
            label: 'PM2.5 ¬µg/m¬≥',
            data: data.map(e => parseFloat(e.field8)),
            borderColor: '#00bcd4',
            borderWidth: 2,
            tension: 0.2
          }]
        },
        options: {
          scales: { y: { beginAtZero: true } },
          plugins: { legend: { labels: { color: '#eee' } } }
        }
      });
    }
    function fetchData() {
      fetch('https://api.thingspeak.com/channels/2956838/feeds.json?api_key=1MLQRZI24QGYN958&results=10')
        .then(res => res.json()).then(data => {
        const f = data.feeds, l = f[f.length - 1];
        document.getElementById('temp').textContent = parseFloat(l.field1).toFixed(2) + ' ¬∞C';
        document.getElementById('co2').textContent = parseFloat(l.field2).toFixed(2) + ' ppm';
        document.getElementById('nh3').textContent = parseFloat(l.field3).toFixed(2) + ' ppm';
        document.getElementById('benzene').textContent = parseFloat(l.field4).toFixed(2) + ' ppm';
        document.getElementById('alcohol').textContent = parseFloat(l.field5).toFixed(2) + ' ppm';
        document.getElementById('smoke').textContent = parseFloat(l.field6).toFixed(2) + ' ppm';
        document.getElementById('pm1').textContent = parseFloat(l.field7).toFixed(0) + ' ¬µg/m¬≥';
        document.getElementById('pm25').textContent = parseFloat(l.field8).toFixed(0) + ' ¬µg/m¬≥';
        drawChart(f);
        document.getElementById('logBox').textContent = 'Full Log (Recent)\n' + f.map(e => `${new Date(e.created_at).toLocaleTimeString()} ‚Äî Temp: ${e.field1} ¬∞C, CO‚ÇÇ: ${e.field2} ppm, PM2.5: ${e.field8} ¬µg/m¬≥`).join('\n');
      });
    }
    function toggleLog() {
      const log = document.getElementById('logBox');
      log.style.display = log.style.display === 'block' ? 'none' : 'block';
    }
    function toggleGraph() {
      const graph = document.getElementById('graphBox');
      graph.style.display = graph.style.display === 'block' ? 'none' : 'block';
    }
    updateTime();
    fetchData();
    setInterval(() => { updateTime(); fetchData(); }, 5000);
  </script>
</body>
</html>
