<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Roasted Flavors Dashboard</title>
  <style>
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background-image: url('BG Dashboard Sora Night.png');
      background-size: cover;
      background-position: center;
      color: white;
      display: flex;
      justify-content: flex-end;
      align-items: flex-start;
      height: 100vh;
      flex-direction: column;
      padding: 20px;
    }
    .dashboard {
      max-width: 300px;
      width: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      border-radius: 12px;
      padding: 16px;
    }
    .title {
      font-weight: bold;
      font-size: 1rem;
      margin-bottom: 5px;
    }
    .timestamp {
      font-size: 0.75rem;
      color: #ccc;
    }
    .card {
      margin: 6px 0;
      background: rgba(0,0,0,0.4);
      border-radius: 10px;
      padding: 6px 12px;
    }
    .label {
      font-size: 0.75rem;
      color: #aaa;
    }
    .value {
      font-size: 1rem;
      font-weight: bold;
    }
    .green { color: #00e676; }
    .yellow { color: #fbc02d; }
    .red { color: #ef5350; }
    .cyan { color: #00e5ff; }
    .log-table {
      background: rgba(255,255,255,0.05);
      color: #eee;
      font-size: 0.75rem;
      margin-top: 16px;
      max-height: 200px;
      overflow-y: auto;
    }
    .log-table table {
      width: 100%;
      border-collapse: collapse;
    }
    .log-table th, .log-table td {
      border-bottom: 1px solid #555;
      padding: 4px;
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <div class="title">ROASTED FLAVORS DASHBOARD</div>
    <div class="timestamp">
      Updated: <span id="timestamp"></span><br />
      Weather: ðŸŒ™
    </div>
    <div id="cards"></div>
    <div class="log-table">
      <table>
        <thead>
          <tr><th>Time</th><th>Temp</th><th>COâ‚‚</th><th>NHâ‚ƒ</th><th>Benzene</th><th>Alcohol</th><th>Smoke</th><th>PM1.0</th><th>PM2.5</th></tr>
        </thead>
        <tbody id="log"></tbody>
      </table>
    </div>
  </div>
  <script>
    const API_URL = "https://api.thingspeak.com/channels/2956838/feeds.json?results=1";
    const cards = [
      { label: "Temperature", field: 'field1', unit: 'Â°C' },
      { label: "COâ‚‚", field: 'field2', unit: 'ppm' },
      { label: "NHâ‚ƒ", field: 'field3', unit: 'ppm' },
      { label: "Benzene", field: 'field4', unit: 'ppm' },
      { label: "Alcohol", field: 'field5', unit: 'ppm' },
      { label: "Smoke", field: 'field6', unit: 'ppm' },
      { label: "PM1.0", field: 'field7', unit: 'Âµg/mÂ³' },
      { label: "PM2.5", field: 'field8', unit: 'Âµg/mÂ³' },
    ];
    const logs = [];
    function getColor(value, label) {
      value = parseFloat(value);
      if (isNaN(value)) return '';
      if (label === 'Temperature') return 'green';
      if (label === 'Alcohol' || label === 'COâ‚‚' || label === 'NHâ‚ƒ' || label === 'Benzene' || label === 'Smoke') {
        if (value > 0.5) return 'red';
        if (value > 0.3) return 'yellow';
        return 'green';
      }
      if (label.startsWith('PM')) {
        if (value > 35) return 'red';
        if (value > 15) return 'yellow';
        return 'green';
      }
      return 'green';
    }
    async function fetchData() {
      const res = await fetch(API_URL);
      const data = await res.json();
      const feed = data.feeds[0];
      const date = new Date(feed.created_at);
      document.getElementById("timestamp").textContent = date.toLocaleString();

      const container = document.getElementById("cards");
      container.innerHTML = "";
      const row = [date.toLocaleTimeString()];

      cards.forEach(c => {
        const value = feed[c.field] || "0";
        row.push(value);
        const color = getColor(value, c.label);
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `<div class='label'>${c.label}</div><div class='value ${color}'>${value} ${c.unit}</div>`;
        container.appendChild(div);
      });

      logs.unshift(row);
      if (logs.length > 50) logs.pop();
      document.getElementById("log").innerHTML = logs.map(r => `<tr>${r.map(v => `<td>${v}</td>`).join('')}</tr>`).join('');
    }

    fetchData();
    setInterval(fetchData, 5000);
  </script>
</body>
</html>
